<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=https://use.fontawesome.com/e3112f1bdf.css><link rel=stylesheet href=/css/flex.min.0d2501d041d233e1f887af4ccf3fcfbfb60ff4276a16165c66500fe1a78f85da.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><title>GO: Running with Kubernetes</title><link rel=canonical href=/walkthroughs/core/local-kubernetes.html><link rel=alternate type=application/rss+xml href=/blog/index.xml title="Game On! Adventures with microservices"></head><body><header class=head-single><h1><a href=/>GAME<span class=on>ON</span></a></h1><div>Hands-on experiment building microservices and cloud native applications</div></header><nav class=project><a target=_blank href=https://gameontext.org title="Play the game"><i class="fa fa-play" aria-hidden=true></i><span>Play <span>the game</span></span></a>
<a href=/about/ title="Read the book"><i class="fa fa-book" aria-hidden=true></i><span>Learn <span>more</span></span></a>
<a href=/blog/ title="Read the blog"><i class="fa fa-newspaper-o" aria-hidden=true></i><span>Read <span>our blog</span></span></a>
<a target=_blank href=https://gameontext.org/slackin/ title="Join our slack team"><i class="fa fa-slack" aria-hidden=true></i><span><span>Join us on</span> Slack</span></a>
<a target=_blank class=github href=https://github.com/gameontext title="View project on GitHub"><i class="fa fa-github" aria-hidden=true></i><span>Github</span></a></nav><main class="book page"><article><header><h1>Running with Kubernetes</h1></header><nav id=toc class=toc role=doc-toc><h2 id=toc-title></h2><ol class="toc-list level-1"><li><a href=#_requirements>Requirements</a></li><li><a href=#running>Starting game services locally</a></li><li><a href=#_files_supporting_kubernetes>Files supporting Kubernetes</a></li><li><a href=#_configuration>Configuration</a></li><li><a href=#rebuild>Rebuilding Core Game services with Kubernetes</a></li></ol></nav><section class="doc-section level-1"><h2 id=_requirements>Requirements</h2><div class=ulist><ul><li><a href=https://docs.docker.com/engine/installation/>Docker</a></li><li>Kubernetes version 1.9 or greater:<ul><li>[kubectl]</li><li>A <a href=https://github.com/gameontext/gameon/tree/master/kubernetes#set-up-a-kubernetes-cluster>configured Kubernetes cluster</a></li></ul></li><li><a href=https://docs.helm.sh/using_helm/#installing-helm>helm</a> (optional)</li></ul></div></section><section class="doc-section level-1"><h2 id=running>Starting game services locally</h2><div class="olist arabic"><ol class=arabic><li>Obtain the source for the root project (<a href=https://github.com/gameontext/gameon>gameontext/gameon</a>)<ul><li>HTTPS: <code>git clone <a class=bare href=https://github.com/gameontext/gameon.git>https://github.com/gameontext/gameon.git</a></code></li><li>SSH: <code>git clone <a href=mailto:git@github.com>git@github.com</a>:gameontext/gameon.git</code></li></ul></li><li><p>Change to the gameon directory</p><div class=listing-block><pre>$ cd gameon</pre></div></li><li><p>Setup your environment (one time, see <a href=#go-run>below</a>).</p><div class=listing-block><pre>$ ./go-admin.sh choose       # choose Docker Compose
$ eval $(./go-admin.sh env)  # set script aliases
$ alias go-run               # confirm `docker/go-run.sh`</pre></div></li><li><p>Set up core game services (repeatable):</p><div class=listing-block><pre>$ go-run setup</pre></div><p>This will ensure you have the right versions of applications we use, prompt to
use helm or not, and create a certificate for signing JWTs.</p><p>If your cluster IP changes (or you have made changes to some templated
files and want to start over), use:</p><div class=listing-block><pre>$ go-run reset</pre></div><p>All script commands in the following steps will show the command (<code>kubectl</code> or
<code>helm</code>) being invoked, so you can follow along, or invoke on your own.</p></li><li><p>Start core game services:</p><div class=listing-block><pre>$ go-run up</pre></div><p>This step will also create a <code>gameon-system</code> name space and a generic kubernetes
secret containing that certificate.</p></li><li><p>Wait for the system warm up</p><div class=listing-block><pre>$ go-run wait</pre></div><p>or, to watch the action, visit the kubernetes dashboard. For example, with
<code>minikube</code>, try:</p><div class=listing-block><pre>$ minikube dashboard</pre></div></li><li><strong>Carry on with <a href=/walkthroughs/advanced/>building your room</a>!</strong></li><li><p>Clean up</p><div class=listing-block><pre>$ go-run down</pre></div></li></ol></div></section><section class="doc-section level-1"><h2 id=_files_supporting_kubernetes>Files supporting Kubernetes</h2><p>The <code>kubernetes</code> subdirectory of the root project contains the following:</p><div class=ulist><ul><li><code>chart/gameon-system</code> (directory) defines a helm chart for deploying core game services</li><li><code>kubectl</code> (directory) defines individual YAML files to create Kubernetes artifacts
(config maps, services, and deployments)</li><li><code>.template.configmap.yaml</code>, <code>.template.ingress.yaml</code>, and <code>.template.values.yaml</code>
are copied into the <code>kubectl</code> and <code>chart</code> directories by the setup script once
the cluster IP address is known.</li><li><code>go-run.sh</code> helps with starting, stopping, and cleaning up Game On! core services.</li><li><code>k8s-functions</code> contains most of the functions working directly with <code>kubectl</code> or <code>helm</code>.</li></ul></div></section><section class="doc-section level-1"><h2 id=_configuration>Configuration</h2><p>When Game On! runs in the cloud, it uses etcd to obtain its configuration.
When running locally it expects all this to be fed to it via the environment.</p><p>With Kubernetes, configuration is injected via <code>ConfigMap</code> objects:
* When using <code>kubectl</code> alone, configuration attributes are provided by
<code>kubectl/configmap.yaml</code>.
* When using <code>helm</code>, configuration attributes are provided by
<code>chart/gameon-system/values.yaml</code></p><p>As referenced earlier, these files won&#8217;t exist until the setup script has
run at least once.</p></section><section class="doc-section level-1"><h2 id=rebuild>Rebuilding Core Game services with Kubernetes</h2><p><em>TBD</em></p><aside class="admonition-block note" id=go-run role=note><h6 class=block-title><span class=title-label>Note: </span>About <code>go-run.sh</code> and <code>go-run</code>:</h6><div class=ulist><ul><li><p>Use <code>eval $(./kubernetes/go-run.sh env)</code> to add <code>go-run</code> and <code>go-admin</code> aliases
to your shell:</p><div class=listing-block><pre>$ eval $(./kubernetes/go-run.sh env)
$ alias</pre></div></li><li><p>Use <code>go-run</code> without arguments to get a list of available actions. Some examples
based on the alias created above:</p><div class=listing-block><pre>$ go-run setup
$ go-run up
$ go-run wait
$ go-run down</pre></div></li></ul></div></aside></section></article><nav class=prev-next><div class=nav-left><div class=long><a href=/walkthroughs/core/local-docker.html title="Previous: Running with Docker Compose">Running with Docker Compose</a></div><div class=short><a href=/walkthroughs/core/local-docker.html title="Previous: Running with Docker Compose">Previous</a></div></div><div class=nav-center><div class=long>Up: <a href=/walkthroughs/core/>Running core services locally</a></div><div class=short><a href=/walkthroughs/core/>Up</a></div></div><div class=nav-right><div class=long><a href=/walkthroughs/core/local-build.html title="Next: Working with Game On! Locally">Working with Game On! Locally</a></div><div class=short><a href=/walkthroughs/core/local-build.html title="Next: Working with Game On! Locally">Next</a></div></div></nav></main><footer class=foot><div id=copyrights>&#169; 2016-2021 under terms of the Apache License 2.0.</div><div>Follow us:
<a target=_blank href=https://twitter.com/gameontext title="Follow @gameontext"><i class="fa fa-twitter" aria-hidden=true></i></a></div></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-90113653-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>