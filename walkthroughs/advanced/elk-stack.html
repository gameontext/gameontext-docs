<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=https://use.fontawesome.com/e3112f1bdf.css><link rel=stylesheet href=/css/flex.min.82916dff37dfd913211404396f31b8f7eecf60f393cfd65ec00c0d7df8dafcb6.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><title>GO: Logging using the ELK stack</title><link rel=canonical href=/walkthroughs/advanced/elk-stack.html><link rel=alternate type=application/rss+xml href=/blog/index.xml title="Game On! Adventures with microservices"></head><body><header class=head-single><h1><a href=/>GAME<span class=on>ON</span></a></h1><div>Hands-on experiment building microservices and cloud native applications</div></header><nav class=project><a href=/about/ title="Read the book"><i class="fa fa-book" aria-hidden=true></i><span>Learn <span>more</span></span></a>
<a href=/blog/ title="Read the blog"><i class="fa fa-newspaper-o" aria-hidden=true></i><span>Read <span>our blog</span></span></a>
<a target=_blank class=github href=https://github.com/gameontext title="View project on GitHub"><i class="fa fa-github" aria-hidden=true></i><span>Github</span></a></nav><main class="book page"><article><header><h1>Logging using the ELK stack</h1></header><p>Once you&#8217;ve created a room, the next thing you&#8217;ll want to do is figure out how
to send the room&#8217;s logs somewhere so that when your room is stopped (and its
local filesystem disappears) you don&#8217;t lose your diagnostic data. You also
will want to be able to view your logs, and other events, from a dashboard to
make it easy to find problems without having to look at each room&#8217;s files one at a time.</p><section class="doc-section level-1"><h2 id=_the_elk_stack>The ELK Stack</h2><p>ELK is Elasticsearch, Logstash, and Kibana. It is a very common stack used
to collect, aggregate, search, and view logs in the cloud. Logstash is to used to
ingest events and forward them to an Elasticsearch instance. Elasticsearch stores
and indexes events. You use your browser to interact with Kibana, which provides
customizable dashboards using events it queries from Elasticsearch.</p></section><section class="doc-section level-1"><h2 id=_working_with_logs_in_bluemix>Working with logs in Bluemix</h2><p>Each Bluemix space has its own dedicated place to store logs and other events.
This event storage is a multi-tenant ELK setup. To ensure security, each Bluemix
space has its own separate Elasticsearch tenant.</p><section class="doc-section level-2"><h3 id=_send_your_java_rooms_logs_to_elk>Send your Java room&#8217;s logs to ELK</h3><p>If your room is running on Liberty, and you have a Bluemix org/space, you can
set up your server to send its events to Bluemix&#8217;s ELK in under 5 minutes. Liberty
has a convenient command, the bluemixUtility, to help you leverage services in Bluemix.</p><p>Log in to your Bluemix org/space using Liberty&#8217;s bluemixUtility. This tells the bluemixUtility which org/space to target.</p><div class=ulist><ul><li>US South:</li></ul></div><div class=listing-block><pre class=highlight><code>bluemixUtility login --api=us-south --user=yourUserName --password=yourPassword --org=yourOrg --space=yourSpace</code></pre></div><div class=ulist><ul><li>United Kingdom:</li></ul></div><div class=listing-block><pre class=highlight><code>bluemixUtility login --api=eu-gb --user=yourUserName --password=yourPassword --org=yourOrg --space=yourSpace</code></pre></div><p>Use bluemixUtility to import a Liberty configuration snippet for sending events
to the Bluemix log service. Note that trace and access logs are not enabled in
your Liberty server by default&#8201;&#8211;&#8201;if they are not enabled explicitly in your
server.xml then no trace / access logs will be sent to the Bluemix log service.</p><div class=listing-block><pre class=highlight><code>bluemixUtility import bluemixLog --psource="message,trace,garbageCollection,ffdc,accessLog"</code></pre></div><p>Use bluemixUtility to configure your Liberty server to use the configuration snippet you just downloaded.</p><div class=listing-block><pre class=highlight><code>bluemixUtility bind defaultServer bluemixLog</code></pre></div><p>Your Liberty server will now send its events to the ELK tenant in the Bluemix
org/space you specified.</p></section><section class="doc-section level-2"><h3 id=_deploy_your_elk_enabled_server_to_bluemix_cloud_foundry>Deploy your ELK-enabled server to Bluemix Cloud Foundry</h3><p>You can run your ELK-enabled Liberty server in Bluemix Cloud Foundry.</p><p>As a workaround to a beta issue, you&#8217;ll need to add bluemixLogCollector-1.1
directly to your server.xml&#8217;s featureManager section as follows:</p><div class=listing-block><pre class=highlight><code>&lt;featureManager&gt;
    &lt;feature&gt;bluemixLogCollector-1.1&lt;/feature&gt;
&lt;/featureManager&gt;</code></pre></div><p>The Liberty bluemixLogCollector-1.1 feature, which is what sends your events to
Bluemix, is currently in beta. To run your room in Bluemix Cloud Foundry, tell
the Liberty buildpack to use the beta version of the Liberty runtime:</p><div class=listing-block><pre class=highlight><code>server package defaultServer --include=usr
cf push myApp -p defaultServer.zip
cf set-env myApp IBM_LIBERTY_BETA true
cf set-env myApp JBP_CONFIG_LIBERTY "version: +"
cf restage myApp</code></pre></div><p>Take a look at your log file in Bluemix CF to make sure things are running as
expected.</p><div class=listing-block><pre class=highlight><code>cf files theBadApp logs/messages.log</code></pre></div><p>You should see a message similar to the following:</p><div class=listing-block><pre class=highlight><code>[7/25/16 1:53:27:437 UTC] 00000029 com.ibm.ws.logmet.collector.internal.LogmetClient            I TRAS0214I: The collector is connected to the Bluemix log collection server on the specified host logs.eu-gb.opvis.bluemix.net and port number 9091.</code></pre></div></section><section class="doc-section level-2"><h3 id=_use_your_kibana_dashboard_to_see_your_log_and_other_events>Use your Kibana dashboard to see your log (and other) events</h3><p>Once you have your log (and other) events going to Bluemix&#8217;s ELK you can use Kibana&#8217;s powerful dashboards to explore your data.</p><p>To access your Kibana dashboard, use the URL below that matches where your Bluemix space is located:</p><div class=ulist><ul><li>US South: <a class=bare href=https://logmet.ng.bluemix.net/>https://logmet.ng.bluemix.net/</a></li><li>United Kingdom: <a class=bare href=https://logmet.eu-gb.bluemix.net/>https://logmet.eu-gb.bluemix.net/</a></li></ul></div><p>Initially you will see the default Kibana dashboard. This dashboard shows you log and trace events over time from all servers that have sent their events to that Bluemix org/space&#8217;s ELK tenant. You can zoom in on a particular time range by clicking on the graph and dragging across the time range you want to see.</p><p>To see the Liberty dashboard, click the load (folder) icon in the top right corner of the Kibana interface and select the Liberty-K3-* choice. A set of tables and graphs specific to Liberty should appear. A few things you can try:</p><div class=ulist><ul><li>look at the Hosts / User Directories / Servers row to see if you can spot your server. The "count" shows how many events have been consumed by Elasticsearch in the time window you are looking at. If you are sending data from multiple servers to ELK, try clicking on the magnifying glass icon to filter in only the server you are interested in. Filters apply to the whole dashboard.</li><li>look at the Hot Messages / Hot Response Codes / Slow Hits / Slow GC row to see if there are any highlights you need to be aware of immediately.</li><li>expand each of the collapsed rows (for example, the Record Counts - Logs row, or the Garbage Collection Row) to explore your data.</li><li>try zooming in on a time range by clicking and dragging across a time range on a graph - look for correlations between graphs (for example a long hit duration at about the same time as a message printed to your logs) when you zoom.</li><li>expand rows near the bottom (messages table, access log table, and others) to see the your actual logs, trace, access logs, ffdc and garbage collection events.</li><li>feeling adventurous? Try clicking "ADD A ROW" at the bottom of the dashboard and adding your own visualizations&#8201;&#8211;&#8201;there are lots of youtube videos showing how to use Kibana!</li></ul></div></section></section></article><nav class=prev-next><div class=nav-left><div class=long><a href=/walkthroughs/advanced/watson-conversation.html title="Previous: Watson Conversation Service">Watson Conversation Service</a></div><div class=short><a href=/walkthroughs/advanced/watson-conversation.html title="Previous: Watson Conversation Service">Previous</a></div></div><div class=nav-center><div class=long>Up: <a href=/walkthroughs/advanced/>Advanced Adventures</a></div><div class=short><a href=/walkthroughs/advanced/>Up</a></div></div><div class=nav-right><div class=long><a href=/walkthroughs/advanced/istio.html title="Next: Istio and Kubernetes">Istio and Kubernetes</a></div><div class=short><a href=/walkthroughs/advanced/istio.html title="Next: Istio and Kubernetes">Next</a></div></div></nav></main><footer class=foot><div id=copyrights>&#169; 2016-2023 under terms of the Apache License 2.0.</div></footer></body></html>